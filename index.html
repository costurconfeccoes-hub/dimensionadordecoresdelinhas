<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dimensionador de Cores de Linhas - Costur Confecções</title>
    
    <!-- Bibliotecas necessárias -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Biblioteca para JSZip (download do relatório) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        /* RESET E ESTILOS GERAIS RESPONSIVOS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --text: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --admin-color: #8e44ad;
            --completed-color: #27ae60;
            --pix-color: #32BCAD;
            --negative-color: #e74c3c;
            --bonus-color: #9b59b6;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            width: 100%;
            overflow-x: hidden;
        }

        /* CONTAINER RESPONSIVO */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* HEADER RESPONSIVO */
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            text-align: center;
        }

        @media (min-width: 768px) {
            .logo-container {
                justify-content: flex-start;
                text-align: left;
            }
        }

        .logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid var(--secondary);
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .logo {
                width: 70px;
                height: 70px;
            }
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            margin-bottom: 5px;
            color: white;
        }

        @media (min-width: 768px) {
            .logo-text h1 {
                font-size: 1.8rem;
            }
        }

        .logo-text p {
            font-style: italic;
            opacity: 0.9;
            font-size: 0.9rem;
            color: white;
        }

        @media (min-width: 768px) {
            .logo-text p {
                font-size: 1rem;
            }
        }

        .header-contact {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .header-contact {
                align-items: flex-end;
                text-align: right;
            }
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #FFF;
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .contact-item {
                font-size: 1rem;
            }
        }

        .contact-item i {
            color: #FFF;
            font-size: 0.8rem;
        }

        @media (min-width: 768px) {
            .contact-item i {
                font-size: 0.9rem;
            }
        }

        .contact-item span {
            color: #FFF;
            font-weight: 500;
        }

        /* HERO SECTION RESPONSIVA */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1520006403909-838d6b92c22e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        @media (min-width: 768px) {
            .hero {
                padding: 80px 0;
            }
        }

        .hero h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            .hero h2 {
                font-size: 2.5rem;
                margin-bottom: 25px;
            }
        }

        .hero p {
            font-size: 1rem;
            max-width: 100%;
            margin: 0 auto 25px;
            padding: 0 15px;
        }

        @media (min-width: 768px) {
            .hero p {
                font-size: 1.3rem;
                max-width: 800px;
                margin: 0 auto 40px;
            }
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        @media (min-width: 768px) {
            .btn {
                padding: 15px 40px;
                font-size: 1.1rem;
            }
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-3px);
        }

        /* SECTIONS RESPONSIVAS */
        section {
            padding: 40px 0;
        }

        @media (min-width: 768px) {
            section {
                padding: 70px 0;
            }
        }

        .section-title {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding: 0 15px;
        }

        @media (min-width: 768px) {
            .section-title {
                margin-bottom: 40px;
            }
        }

        .section-title h2 {
            font-size: 1.6rem;
            color: var(--primary);
            display: inline-block;
            padding-bottom: 10px;
        }

        @media (min-width: 768px) {
            .section-title h2 {
                font-size: 2.2rem;
                padding-bottom: 15px;
            }
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            width: 80px;
            height: 4px;
            background-color: var(--secondary);
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        @media (min-width: 768px) {
            .section-title h2::after {
                width: 100px;
            }
        }

        /* CARD STYLES RESPONSIVOS */
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            width: 100%;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .card {
                padding: 30px;
                margin-bottom: 30px;
                border-radius: 12px;
            }
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            font-size: 1.4rem;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .card h2 {
                font-size: 1.6rem;
                margin-bottom: 25px;
                padding-bottom: 15px;
            }
        }
        
        .card h2 i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .form-group {
                margin-bottom: 25px;
            }
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        @media (min-width: 768px) {
            label {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }
        }
        
        input, select, button, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            input, select, button, textarea {
                padding: 15px 20px;
                font-size: 1.1rem;
            }
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        button {
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn-image {
            background: var(--success-color);
            padding: 12px 25px;
            font-size: 1rem;
            width: auto;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .btn-image {
                padding: 15px 30px;
                font-size: 1.1rem;
                margin-top: 20px;
            }
        }
        
        .btn-image i {
            margin-right: 8px;
        }

        @media (min-width: 768px) {
            .btn-image i {
                margin-right: 10px;
            }
        }
        
        .btn-pix {
            background: var(--pix-color);
            padding: 12px 25px;
            font-size: 1rem;
            width: auto;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .btn-pix {
                padding: 15px 30px;
                font-size: 1.1rem;
            }
        }
        
        .btn-pix i {
            margin-right: 8px;
        }

        @media (min-width: 768px) {
            .btn-pix i {
                margin-right: 10px;
            }
        }
        
        .btn-delete {
            background: var(--danger-color);
            padding: 8px 15px;
            font-size: 0.9rem;
            width: auto;
            margin-left: 10px;
        }

        @media (min-width: 768px) {
            .btn-delete {
                padding: 10px 20px;
                font-size: 1rem;
                margin-left: 15px;
            }
        }
        
        .btn-add-service {
            background: var(--success-color);
            padding: 10px 20px;
            font-size: 0.95rem;
            width: auto;
            margin-top: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .btn-add-service {
                padding: 12px 25px;
                font-size: 1rem;
                margin-top: 15px;
            }
        }
        
        .btn-add-service i {
            margin-right: 8px;
        }

        @media (min-width: 768px) {
            .btn-add-service i {
                margin-right: 10px;
            }
        }
        
        .btn-remove-service {
            background: var(--danger-color);
            padding: 8px 12px;
            font-size: 0.85rem;
            width: auto;
        }

        @media (min-width: 768px) {
            .btn-remove-service {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
        }

        .btn-change-status {
            background: var(--admin-color);
            padding: 8px 15px;
            font-size: 0.95rem;
            width: auto;
            margin-left: 10px;
        }

        @media (min-width: 768px) {
            .btn-change-status {
                padding: 10px 20px;
                font-size: 1rem;
                margin-left: 15px;
            }
        }

        .invoice-preview {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            background: white;
            display: none;
        }

        @media (min-width: 768px) {
            .invoice-preview {
                padding: 30px;
                margin-top: 30px;
                border-radius: 12px;
            }
        }
        
        .image-actions {
            margin-top: 20px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .image-actions {
                flex-direction: row;
                gap: 15px;
                justify-content: center;
                margin-top: 25px;
                padding-top: 25px;
            }
        }
        
        /* Estilos específicos para a página de dimensionador de cores - RESPONSIVO */
        .upload-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .upload-options {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 30px;
            }
        }
        
        .upload-option {
            background: #f9f9f9;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        @media (min-width: 768px) {
            .upload-option {
                padding: 30px;
                border-radius: 10px;
            }
        }
        
        .upload-option:hover {
            border-color: var(--secondary);
            background: #e8f4fd;
            transform: translateY(-3px);
        }
        
        .upload-option i {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 12px;
        }

        @media (min-width: 768px) {
            .upload-option i {
                font-size: 3rem;
                margin-bottom: 15px;
            }
        }
        
        .upload-option h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        @media (min-width: 768px) {
            .upload-option h3 {
                font-size: 1.3rem;
                margin-bottom: 10px;
            }
        }
        
        .upload-option p {
            color: #666;
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .upload-option p {
                font-size: 0.9rem;
            }
        }
        
        .image-preview-container {
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        @media (min-width: 768px) {
            .image-preview-container {
                margin-top: 30px;
            }
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            display: block;
            margin: 0 auto 15px;
        }

        @media (min-width: 768px) {
            .image-preview {
                max-height: 400px;
                border-radius: 10px;
                margin-bottom: 20px;
            }
        }
        
        .color-results {
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .color-results {
                margin-top: 30px;
            }
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        @media (min-width: 768px) {
            .color-palette {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }
        }

        @media (min-width: 1024px) {
            .color-palette {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }
        
        .color-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        @media (min-width: 768px) {
            .color-item {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .color-preview {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 2px solid #eee;
        }

        @media (min-width: 768px) {
            .color-preview {
                width: 100px;
                height: 100px;
                border-radius: 8px;
                margin-bottom: 12px;
            }
        }
        
        .color-info {
            text-align: center;
            width: 100%;
        }
        
        .color-name {
            display: none; /* REMOVIDO: Não mostrar nome da cor */
        }
        
        .color-code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--primary);
            background: #f9f9f9;
            padding: 5px 8px;
            border-radius: 4px;
            margin-bottom: 5px;
            word-break: break-word;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .color-code {
                font-size: 1rem;
                padding: 6px 10px;
            }
        }
        
        .color-percentage {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        @media (min-width: 768px) {
            .color-percentage {
                font-size: 1rem;
            }
        }
        
        .color-group-info {
            margin-top: 5px;
            padding: 4px 6px;
            background: #f0f8ff;
            border-radius: 3px;
            font-size: 0.75rem;
            color: #666;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .color-group-info {
                font-size: 0.8rem;
                padding: 5px 8px;
                margin-top: 6px;
            }
        }
        
        .dominant-color {
            border: 3px solid var(--success-color);
            transform: scale(1.02);
            background: linear-gradient(135deg, #f9f9f9, #e8f4fd);
        }

        @media (min-width: 768px) {
            .dominant-color {
                transform: scale(1.05);
            }
        }
        
        .dominant-badge {
            background: var(--success-color);
            color: white;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-top: 5px;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .dominant-badge {
                font-size: 0.8rem;
                padding: 3px 8px;
            }
        }
        
        .fabric-type-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .fabric-type-selector {
                flex-direction: row;
                gap: 20px;
                margin-bottom: 30px;
            }
        }
        
        .fabric-type {
            flex: 1;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        @media (min-width: 768px) {
            .fabric-type {
                padding: 20px;
                border-radius: 10px;
            }
        }
        
        .fabric-type:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .fabric-type.selected {
            border-color: var(--secondary);
            background-color: #e8f4fd;
        }
        
        .fabric-type i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 12px;
        }

        @media (min-width: 768px) {
            .fabric-type i {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }
        }
        
        .fabric-type h3 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        @media (min-width: 768px) {
            .fabric-type h3 {
                font-size: 1.3rem;
                margin-bottom: 10px;
            }
        }
        
        .fabric-type p {
            color: #666;
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .fabric-type p {
                font-size: 0.9rem;
            }
        }
        
        .report-preview {
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 20px;
            background: white;
            display: none;
        }

        @media (min-width: 768px) {
            .report-preview {
                padding: 25px;
                border-radius: 10px;
            }
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        @media (min-width: 768px) {
            .report-header {
                margin-bottom: 25px;
                padding-bottom: 15px;
            }
        }
        
        .report-title {
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        @media (min-width: 768px) {
            .report-title {
                font-size: 1.8rem;
                margin-bottom: 10px;
            }
        }
        
        .report-date {
            color: #666;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .report-date {
                font-size: 1rem;
            }
        }
        
        .report-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .report-content {
                display: grid;
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        @media (min-width: 1024px) {
            .report-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .report-image-container {
            text-align: center;
            order: 2;
        }

        @media (min-width: 768px) {
            .report-image-container {
                order: 1;
            }
        }
        
        .report-image {
            max-width: 100%;
            max-height: 250px;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        @media (min-width: 768px) {
            .report-image {
                max-height: 300px;
                border-radius: 8px;
                margin-bottom: 15px;
            }
        }
        
        .report-colors {
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            order: 1;
        }

        @media (min-width: 768px) {
            .report-colors {
                padding: 20px;
                border-radius: 8px;
                order: 2;
            }
        }
        
        .report-dominant-color {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        @media (min-width: 768px) {
            .report-dominant-color {
                flex-direction: row;
                align-items: center;
                padding: 20px;
                border-radius: 8px;
            }
        }
        
        .report-dominant-preview {
            width: 70px;
            height: 70px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 3px solid #eee;
        }

        @media (min-width: 768px) {
            .report-dominant-preview {
                width: 80px;
                height: 80px;
                border-radius: 8px;
                margin-right: 20px;
                margin-bottom: 0;
            }
        }
        
        .report-dominant-info {
            text-align: center;
            flex: 1;
        }

        @media (min-width: 768px) {
            .report-dominant-info {
                text-align: left;
            }
        }
        
        .report-dominant-info h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: none; /* REMOVIDO: Não mostrar título */
        }

        .report-dominant-info p {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        @media (min-width: 768px) {
            .report-dominant-info p {
                font-size: 1rem;
                margin-bottom: 10px;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--primary);
        }

        @media (min-width: 768px) {
            .loading {
                padding: 30px;
            }
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 15px;
        }

        @media (min-width: 768px) {
            .loading-spinner {
                width: 50px;
                height: 50px;
                margin: 0 auto 20px;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: linear-gradient(135deg, #ffe6e6, #ffd4d4);
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 4px solid var(--danger-color);
            color: var(--danger-color);
            font-weight: bold;
            display: none;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .error-message {
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                font-size: 1rem;
            }
        }
        
        .success-message {
            background: linear-gradient(135deg, #e6ffe6, #d4ffd4);
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
            font-weight: bold;
            display: none;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .success-message {
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                font-size: 1rem;
            }
        }
        
        .color-suggestions {
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .color-suggestions {
                margin-top: 30px;
            }
        }
        
        .thread-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        @media (min-width: 768px) {
            .thread-suggestions {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }
        }
        
        .thread-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .thread-item {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        .thread-color {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            margin-right: 12px;
            border: 2px solid #eee;
            flex-shrink: 0;
        }

        @media (min-width: 768px) {
            .thread-color {
                width: 40px;
                height: 40px;
                margin-right: 15px;
            }
        }
        
        .thread-info {
            flex: 1;
            min-width: 0;
        }
        
        .thread-code {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.95rem;
            margin-bottom: 3px;
            word-break: break-word;
        }

        @media (min-width: 768px) {
            .thread-code {
                font-size: 1rem;
            }
        }
        
        .thread-name {
            font-size: 0.8rem;
            color: #666;
            word-break: break-word;
        }

        @media (min-width: 768px) {
            .thread-name {
                font-size: 0.9rem;
            }
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        @media (min-width: 768px) {
            footer {
                padding: 25px 0;
            }
        }
        
        .copyright {
            text-align: center;
            font-size: 0.85rem;
            color: #aaa;
        }

        @media (min-width: 768px) {
            .copyright {
                font-size: 1rem;
            }
        }
        
        /* Estilos para o relatório */
        .report-download-info {
            margin-top: 15px;
            text-align: center;
            color: #666;
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .report-download-info {
                margin-top: 20px;
                font-size: 0.9rem;
            }
        }
        
        /* Estilos para o webcam */
        .webcam-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .webcam-container {
                max-width: 640px;
            }
        }
        
        #webcam {
            width: 100%;
            border-radius: 8px;
            display: none;
            aspect-ratio: 16/9;
            object-fit: cover;
        }

        @media (min-width: 768px) {
            #webcam {
                border-radius: 10px;
            }
        }
        
        .webcam-controls {
            margin-top: 15px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .webcam-controls {
                margin-top: 20px;
            }
        }
        
        .webcam-preview {
            position: relative;
        }
        
        .capture-btn {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (min-width: 768px) {
            .capture-btn {
                width: 70px;
                height: 70px;
                font-size: 1.5rem;
                bottom: 20px;
            }
        }
        
        .capture-btn:hover {
            background: #2980b9;
            transform: translateX(-50%) scale(1.1);
        }
        
        /* Estilos para informações de cores */
        .color-details {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        @media (min-width: 768px) {
            .color-details {
                margin-top: 20px;
                padding: 20px;
                border-radius: 10px;
            }
        }
        
        .color-property {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .color-property {
                font-size: 1rem;
                margin-bottom: 10px;
                padding-bottom: 10px;
            }
        }
        
        .color-property:last-child {
            border-bottom: none;
        }
        
        .property-label {
            font-weight: bold;
            color: var(--primary);
        }
        
        .property-value {
            color: #666;
        }
        
        .simplified-message {
            background: linear-gradient(135deg, #e8f4fd, #d4e9fa);
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid var(--secondary);
            color: var(--primary);
            font-size: 0.85rem;
        }

        @media (min-width: 768px) {
            .simplified-message {
                padding: 15px;
                border-radius: 8px;
                margin-top: 20px;
                font-size: 0.95rem;
            }
        }
        
        .simplified-message i {
            color: var(--secondary);
            margin-right: 8px;
        }

        @media (min-width: 768px) {
            .simplified-message i {
                margin-right: 10px;
            }
        }

        /* Ajustes para telas muito pequenas (celulares) */
        @media (max-width: 480px) {
            .logo-text h1 {
                font-size: 1.2rem;
            }
            
            .logo-text p {
                font-size: 0.8rem;
            }
            
            .contact-item {
                font-size: 0.75rem;
            }
            
            .hero h2 {
                font-size: 1.5rem;
            }
            
            .hero p {
                font-size: 0.9rem;
            }
            
            .section-title h2 {
                font-size: 1.4rem;
            }
            
            .card h2 {
                font-size: 1.3rem;
            }
            
            .color-palette {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .color-preview {
                width: 70px;
                height: 70px;
            }
            
            .color-code {
                font-size: 0.85rem;
                padding: 4px 6px;
            }
            
            .color-percentage {
                font-size: 0.85rem;
            }
            
            .thread-suggestions {
                grid-template-columns: 1fr;
            }
        }

        /* Ajustes para tablets em modo retrato */
        @media (min-width: 481px) and (max-width: 767px) {
            .color-palette {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .thread-suggestions {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }

        /* Ajustes para orientação paisagem em dispositivos móveis */
        @media (max-height: 600px) and (orientation: landscape) {
            .hero {
                padding: 30px 0;
            }
            
            .hero h2 {
                font-size: 1.6rem;
                margin-bottom: 10px;
            }
            
            .hero p {
                margin-bottom: 20px;
            }
            
            section {
                padding: 30px 0;
            }
        }

        /* Impedir zoom em inputs em dispositivos móveis */
        @media (max-width: 767px) {
            input, select, textarea {
                font-size: 16px !important;
            }
        }

        /* Melhorias de acessibilidade para foco */
        button:focus, input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--secondary);
            outline-offset: 2px;
        }

        /* Scroll suave */
        html {
            scroll-behavior: smooth;
        }

        /* Prevenir overflow horizontal */
        body {
            overflow-x: hidden;
        }

        /* Ajustes para o relatório em telas pequenas */
        @media (max-width: 767px) {
            .report-dominant-color {
                text-align: center;
            }
            
            .report-dominant-info p {
                text-align: center;
            }
        }

        /* Estilos para informações visíveis simplificadas */
        .color-result-line {
            display: block;
            margin-bottom: 4px;
        }
        
        .color-result-line:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo-container">
                <div class="logo">
                    <div style="width: 100%; height: 100%; background: var(--secondary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                       <img src="https://i.pinimg.com/1200x/40/a8/e9/40a8e9533769e963fd52ccc646efc7c6.jpg" alt="Costur Confecções" id="logo-image">
                    </div>
                </div>
                <div class="logo-text">
                    <h1>Costur Confecções</h1>
                    <p>Sua marca, nossa costura.</p>
                </div>
            </div>
            <div class="header-contact">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>(81) 9.2140-5569 / (81) 9.9201-4171</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Rua professor ferrucio, 436, São Francisco - Caruaru/PE</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Dimensionador de Cores de Linhas</h2>
            <p>Análise inteligente de tecidos - Agrupamos tons similares para facilitar sua escolha de linha</p>
            <a href="#dimensionador" class="btn">Iniciar Análise</a>
        </div>
    </section>

    <!-- Sistema de Dimensionamento de Cores -->
    <section id="dimensionador">
        <div class="container">
            <div class="section-title">
                <h2>Análise Simplificada de Cores</h2>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-palette"></i> Análise de Cores de Tecidos</h2>
                
                <div class="simplified-message">
                    <i class="fas fa-lightbulb"></i>
                    <strong>Sistema Inteligente:</strong> Agrupamos automaticamente tons similares para facilitar sua escolha de linha.
                </div>
                
                <div class="form-group">
                    <label>Tipo de Tecido</label>
                    <div class="fabric-type-selector">
                        <div class="fabric-type" data-type="liso">
                            <i class="fas fa-square"></i>
                            <h3>Tecido Liso</h3>
                            <p>Cores uniformes sem padrões</p>
                        </div>
                        <div class="fabric-type" data-type="estampado">
                            <i class="fas fa-star"></i>
                            <h3>Tecido Estampado</h3>
                            <p>Padrões e múltiplas cores</p>
                        </div>
                    </div>
                    <input type="hidden" id="fabric-type" value="">
                </div>
                
                <div class="form-group">
                    <label>Escolha como enviar a imagem do tecido:</label>
                    <div class="upload-options">
                        <div class="upload-option" id="upload-file">
                            <i class="fas fa-file-upload"></i>
                            <h3>Enviar Arquivo</h3>
                            <p>Selecione uma imagem do seu computador</p>
                        </div>
                        <div class="upload-option" id="take-photo">
                            <i class="fas fa-camera"></i>
                            <h3>Tirar Foto</h3>
                            <p>Use a câmera do dispositivo</p>
                        </div>
                    </div>
                    
                    <input type="file" id="image-input" accept="image/*" style="display: none;">
                    
                    <div class="webcam-container" id="webcam-container" style="display: none;">
                        <div class="webcam-preview">
                            <video id="webcam" autoplay playsinline></video>
                            <button class="capture-btn" id="capture-btn">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <canvas id="webcam-canvas" style="display: none;"></canvas>
                    </div>
                    
                    <div class="error-message" id="upload-error">
                        <i class="fas fa-exclamation-triangle"></i> <span id="error-text"></span>
                    </div>
                    
                    <div class="success-message" id="upload-success">
                        <i class="fas fa-check-circle"></i> <span id="success-text"></span>
                    </div>
                </div>
                
                <div class="image-preview-container" id="image-preview-container">
                    <h3>Imagem do Tecido</h3>
                    <img id="preview-image" class="image-preview" alt="Prévia da imagem do tecido">
                </div>
                
                <div class="loading" id="analysis-loading">
                    <div class="loading-spinner"></div>
                    <p>Agrupando cores similares, aguarde...</p>
                </div>
                
                <div class="color-results" id="color-results" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Cores Agrupadas do Tecido</h3>
                    
                    <div class="color-details">
                        <h4>Cor Predominante (Mais Presente)</h4>
                        <div class="report-dominant-color" id="dominant-color-display">
                            <!-- Conteúdo será preenchido dinamicamente -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h4>Famílias de Cores Detectadas</h4>
                        <p style="color: #666; font-size: 0.95rem; margin-bottom: 15px;">
                            <i class="fas fa-info-circle"></i> Tons similares foram agrupados para facilitar sua escolha
                        </p>
                        <div class="color-palette" id="color-palette">
                            <!-- Cores agrupadas serão adicionadas aqui -->
                        </div>
                    </div>
                    
                    <div class="color-suggestions" id="color-suggestions" style="display: none;">
                        <h4>Sugestões de Linhas para a Cor Predominante</h4>
                        <div class="thread-suggestions" id="thread-suggestions">
                            <!-- Sugestões de linhas serão adicionadas aqui -->
                        </div>
                    </div>
                </div>
                
                <div class="image-actions">
                    <button class="btn-image" id="analyze-btn" style="display: none;">
                        <i class="fas fa-search"></i> Agrupar e Analisar Cores
                    </button>
                    <button class="btn" id="generate-report-btn" style="display: none;">
                        <i class="fas fa-file-download"></i> Gerar Relatório
                    </button>
                    <button class="btn-pix" id="new-analysis-btn">
                        <i class="fas fa-redo"></i> Nova Análise
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-file-alt"></i> Relatório de Análise</h2>
                <div class="report-preview" id="report-preview">
                    <div class="report-header">
                        <div class="report-title">Relatório de Análise de Cores</div>
                        <div class="report-date" id="report-date">Data e hora: </div>
                    </div>
                    
                    <div class="report-content">
                        <div class="report-image-container">
                            <h4>Imagem Analisada</h4>
                            <img id="report-image" class="report-image" alt="Imagem analisada">
                            <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                                Análise simplificada: cores similares agrupadas
                            </p>
                        </div>
                        
                        <div class="report-colors">
                            <h4>Resultados Agrupados</h4>
                            <div id="report-dominant-color">
                                <!-- Cor predominante do relatório -->
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h5>Resumo da Análise</h5>
                                <div class="color-property">
                                    <span class="property-label">Tipo de Tecido:</span>
                                    <span class="property-value" id="report-fabric-type">-</span>
                                </div>
                                <div class="color-property">
                                    <span class="property-label">Famílias de Cores:</span>
                                    <span class="property-value" id="report-total-colors">-</span>
                                </div>
                                <div class="color-property">
                                    <span class="property-label">Data da Análise:</span>
                                    <span class="property-value" id="report-analysis-date">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-download-info">
                        <p>Relatório gerado pelo Dimensionador de Cores de Linhas - Costur Confecções</p>
                    </div>
                </div>
                
                <div class="image-actions" id="report-actions" style="display: none;">
                    <button class="btn-image" id="download-report-btn">
                        <i class="fas fa-download"></i> Baixar Relatório (Imagem)
                    </button>
                    <button class="btn-pix" id="new-report-btn">
                        <i class="fas fa-redo"></i> Nova Análise
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="copyright">
                Costur Confecções © 2023 - Todos os direitos reservados
            </div>
        </div>
    </footer>

    <script>
        // Variáveis globais
        let currentImage = null;
        let colorAnalysis = null;
        let fabricType = '';
        let webcamStream = null;
        
        // Banco de dados simplificado de cores de linha
        const THREAD_DATABASE = {
            'vermelho': [
                { code: 'V001', name: 'Vermelho Básico', color: '#c1121f' },
                { code: 'V002', name: 'Vermelho Escuro', color: '#800020' }
            ],
            'azul': [
                { code: 'A001', name: 'Azul Básico', color: '#003366' },
                { code: 'A002', name: 'Azul Médio', color: '#4169e1' },
                { code: 'A003', name: 'Azul Claro', color: '#87ceeb' }
            ],
            'verde': [
                { code: 'G001', name: 'Verde Básico', color: '#228b22' },
                { code: 'G002', name: 'Verde Claro', color: '#50c878' }
            ],
            'amarelo': [
                { code: 'Y001', name: 'Amarelo Básico', color: '#ffd700' },
                { code: 'Y002', name: 'Amarelo Claro', color: '#fff44f' }
            ],
            'preto': [
                { code: 'B001', name: 'Preto', color: '#000000' },
                { code: 'B002', name: 'Preto Grafite', color: '#2c3e50' }
            ],
            'branco': [
                { code: 'W001', name: 'Branco', color: '#ffffff' },
                { code: 'W002', name: 'Branco Sujo', color: '#f8f8ff' }
            ],
            'cinza': [
                { code: 'GY001', name: 'Cinza Médio', color: '#808080' },
                { code: 'GY002', name: 'Cinza Escuro', color: '#2f4f4f' }
            ],
            'marrom': [
                { code: 'BR001', name: 'Marrom Básico', color: '#7b3f00' },
                { code: 'BR002', name: 'Marrom Claro', color: '#af6e4d' }
            ],
            'rosa': [
                { code: 'P001', name: 'Rosa Básico', color: '#ff69b4' },
                { code: 'P002', name: 'Rosa Claro', color: '#f4c2c2' }
            ],
            'roxo': [
                { code: 'PU001', name: 'Roxo Básico', color: '#7851a9' },
                { code: 'PU002', name: 'Roxo Claro', color: '#c8a2c8' }
            ],
            'laranja': [
                { code: 'O001', name: 'Laranja Básico', color: '#cc5500' },
                { code: 'O002', name: 'Laranja Claro', color: '#ffcc99' }
            ],
            'bege': [
                { code: 'BE001', name: 'Bege Básico', color: '#f5f5dc' },
                { code: 'BE002', name: 'Bege Escuro', color: '#a67b5b' }
            ]
        };
        
        // Categorias de cores principais (12 cores básicas)
        const BASIC_COLORS = {
            'vermelho': { r: 255, g: 0, b: 0 },
            'laranja': { r: 255, g: 165, b: 0 },
            'amarelo': { r: 255, g: 255, b: 0 },
            'verde': { r: 0, g: 128, b: 0 },
            'azul': { r: 0, g: 0, b: 255 },
            'roxo': { r: 128, g: 0, b: 128 },
            'rosa': { r: 255, g: 192, b: 203 },
            'marrom': { r: 165, g: 42, b: 42 },
            'preto': { r: 0, g: 0, b: 0 },
            'branco': { r: 255, g: 255, b: 255 },
            'cinza': { r: 128, g: 128, b: 128 },
            'bege': { r: 245, g: 245, b: 220 }
        };
        
        // Inicializar sistema
        document.addEventListener('DOMContentLoaded', function() {
            initializeColorAnalyzer();
            setupEventListeners();
            
            // Ajustar altura inicial para mobile
            adjustMobileLayout();
            
            // Adicionar listener para redimensionamento
            window.addEventListener('resize', adjustMobileLayout);
        });
        
        function adjustMobileLayout() {
            // Ajustes específicos para mobile
            if (window.innerWidth <= 767) {
                // Garantir que os botões não quebrem
                const buttons = document.querySelectorAll('.image-actions button');
                buttons.forEach(button => {
                    button.style.minWidth = 'auto';
                    button.style.width = '100%';
                });
            }
        }
        
        function initializeColorAnalyzer() {
            console.log('Sistema simplificado de análise de cores inicializado');
        }
        
        function setupEventListeners() {
            // Seleção de tipo de tecido
            document.querySelectorAll('.fabric-type').forEach(type => {
                type.addEventListener('click', function() {
                    // Remover seleção anterior
                    document.querySelectorAll('.fabric-type').forEach(t => t.classList.remove('selected'));
                    
                    // Adicionar seleção atual
                    this.classList.add('selected');
                    
                    // Atualizar valor
                    fabricType = this.getAttribute('data-type');
                    document.getElementById('fabric-type').value = fabricType;
                    
                    showSuccess(`Tecido ${fabricType === 'liso' ? 'liso' : 'estampado'} selecionado`);
                });
            });
            
            // Upload de arquivo
            document.getElementById('upload-file').addEventListener('click', function() {
                document.getElementById('image-input').click();
            });
            
            // Tirar foto
            document.getElementById('take-photo').addEventListener('click', function() {
                initializeWebcam();
            });
            
            // Input de arquivo
            document.getElementById('image-input').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const file = e.target.files[0];
                    loadImageFromFile(file);
                }
            });
            
            // Botão de captura da webcam
            document.getElementById('capture-btn').addEventListener('click', capturePhoto);
            
            // Botão de análise
            document.getElementById('analyze-btn').addEventListener('click', analyzeColors);
            
            // Botão de nova análise
            document.getElementById('new-analysis-btn').addEventListener('click', resetAnalysis);
            document.getElementById('new-report-btn').addEventListener('click', resetAnalysis);
            
            // Botão para gerar relatório
            document.getElementById('generate-report-btn').addEventListener('click', generateReport);
            
            // Botão de download do relatório
            document.getElementById('download-report-btn').addEventListener('click', downloadReportAsImage);
        }
        
        function showError(message) {
            const errorElement = document.getElementById('upload-error');
            const errorText = document.getElementById('error-text');
            errorText.textContent = message;
            errorElement.style.display = 'block';
            
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }
        
        function showSuccess(message) {
            const successElement = document.getElementById('upload-success');
            const successText = document.getElementById('success-text');
            successText.textContent = message;
            successElement.style.display = 'block';
            
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 3000);
        }
        
        function loadImageFromFile(file) {
            // Validar tipo de arquivo
            if (!file.type.match('image.*')) {
                showError('Por favor, selecione um arquivo de imagem válido (JPG, PNG, etc.)');
                return;
            }
            
            // Validar tamanho (máximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showError('A imagem deve ter no máximo 10MB');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                currentImage = new Image();
                currentImage.onload = function() {
                    displayImagePreview(currentImage);
                    stopWebcam(); // Parar webcam se estiver ativa
                };
                currentImage.src = e.target.result;
            };
            
            reader.onerror = function() {
                showError('Erro ao carregar a imagem');
            };
            
            reader.readAsDataURL(file);
        }
        
        async function initializeWebcam() {
            try {
                // Parar stream anterior se existir
                if (webcamStream) {
                    webcamStream.getTracks().forEach(track => track.stop());
                }
                
                // Solicitar acesso à câmera
                const constraints = {
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                };
                
                // Para mobile, ajustar constraints
                if (window.innerWidth <= 767) {
                    constraints.video = {
                        facingMode: 'environment',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    };
                }
                
                webcamStream = await navigator.mediaDevices.getUserMedia(constraints);
                
                const webcam = document.getElementById('webcam');
                const webcamContainer = document.getElementById('webcam-container');
                
                // Configurar video
                webcam.srcObject = webcamStream;
                webcam.style.display = 'block';
                webcamContainer.style.display = 'block';
                
                // Esconder opções de upload
                document.querySelector('.upload-options').style.display = 'none';
                
                // Mostrar botão de análise
                document.getElementById('analyze-btn').style.display = 'inline-flex';
                
                showSuccess('Câmera ativada. Posicione o tecido e clique no botão para capturar.');
                
            } catch (error) {
                console.error('Erro ao acessar a câmera:', error);
                showError('Não foi possível acessar a câmera. Verifique as permissões.');
            }
        }
        
        function stopWebcam() {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
                webcamStream = null;
            }
            
            const webcam = document.getElementById('webcam');
            const webcamContainer = document.getElementById('webcam-container');
            
            webcam.style.display = 'none';
            webcamContainer.style.display = 'none';
            
            // Mostrar opções de upload novamente
            document.querySelector('.upload-options').style.display = 'grid';
        }
        
        function capturePhoto() {
            const webcam = document.getElementById('webcam');
            const canvas = document.getElementById('webcam-canvas');
            const context = canvas.getContext('2d');
            
            // Configurar canvas com as dimensões do vídeo
            canvas.width = webcam.videoWidth;
            canvas.height = webcam.videoHeight;
            
            // Desenhar o frame atual do vídeo no canvas
            context.drawImage(webcam, 0, 0, canvas.width, canvas.height);
            
            // Converter para imagem
            const imageData = canvas.toDataURL('image/png');
            
            currentImage = new Image();
            currentImage.onload = function() {
                displayImagePreview(currentImage);
                stopWebcam();
            };
            currentImage.src = imageData;
        }
        
        function displayImagePreview(image) {
            const previewContainer = document.getElementById('image-preview-container');
            const previewImage = document.getElementById('preview-image');
            
            // Ajustar tamanho máximo para mobile
            const maxWidth = window.innerWidth <= 767 ? window.innerWidth - 60 : 800;
            const maxHeight = window.innerWidth <= 767 ? 400 : 600;
            
            let width = image.width;
            let height = image.height;
            
            // Redimensionar se necessário
            if (width > maxWidth) {
                height = (maxWidth / width) * height;
                width = maxWidth;
            }
            
            if (height > maxHeight) {
                width = (maxHeight / height) * width;
                height = maxHeight;
            }
            
            previewImage.width = width;
            previewImage.height = height;
            previewImage.src = image.src;
            
            previewContainer.style.display = 'block';
            
            // Mostrar botão de análise
            document.getElementById('analyze-btn').style.display = 'inline-flex';
            
            // Validar se tipo de tecido foi selecionado
            if (!fabricType) {
                showError('Por favor, selecione o tipo de tecido antes de analisar.');
            } else {
                showSuccess('Imagem carregada! Clique em "Agrupar e Analisar Cores"');
            }
        }
        
        async function analyzeColors() {
            // Validar se há imagem
            if (!currentImage) {
                showError('Por favor, carregue uma imagem primeiro.');
                return;
            }
            
            // Validar tipo de tecido
            if (!fabricType) {
                showError('Por favor, selecione o tipo de tecido.');
                return;
            }
            
            // Mostrar loading
            const loadingElement = document.getElementById('analysis-loading');
            const analyzeBtn = document.getElementById('analyze-btn');
            loadingElement.style.display = 'block';
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Agrupando cores...';
            
            try {
                // Criar canvas para análise
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // Definir tamanhos (menor para análise mais rápida, especialmente em mobile)
                const maxSize = window.innerWidth <= 767 ? 100 : 150;
                let width = currentImage.width;
                let height = currentImage.height;
                
                // Redimensionar mantendo proporção
                if (width > height) {
                    if (width > maxSize) {
                        height = (maxSize / width) * height;
                        width = maxSize;
                    }
                } else {
                    if (height > maxSize) {
                        width = (maxSize / height) * width;
                        height = maxSize;
                    }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // Desenhar imagem no canvas
                context.drawImage(currentImage, 0, 0, width, height);
                
                // Obter dados de pixel
                const imageData = context.getImageData(0, 0, width, height);
                const pixels = imageData.data;
                
                // Analisar e agrupar cores SIMPLIFICADO
                colorAnalysis = analyzeAndGroupColors(pixels, fabricType);
                
                // Mostrar resultados
                displayColorAnalysis(colorAnalysis);
                
                // Mostrar botão para gerar relatório
                document.getElementById('generate-report-btn').style.display = 'inline-flex';
                
                showSuccess('Análise concluída! Cores similares foram agrupadas.');
                
            } catch (error) {
                console.error('Erro na análise de cores:', error);
                showError('Erro ao analisar cores. Tente novamente com uma imagem diferente.');
            } finally {
                // Esconder loading
                loadingElement.style.display = 'none';
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Agrupar e Analisar Cores';
            }
        }
        
        function analyzeAndGroupColors(pixels, type) {
            // Mapa para agrupar cores por família
            const colorGroups = new Map();
            
            // Amostrar pixels (pular para análise mais rápida)
            const step = type === 'estampado' ? 8 : 12; // Mais amostras para estampados
            
            for (let i = 0; i < pixels.length; i += 4 * step) {
                const r = pixels[i];
                const g = pixels[i + 1];
                const b = pixels[i + 2];
                const a = pixels[i + 3];
                
                // Ignorar pixels muito transparentes
                if (a < 128) continue;
                
                // Encontrar a cor básica mais próxima
                const closestColor = findClosestBasicColor(r, g, b);
                
                // Calcular "tom" (claro/escuro)
                const brightness = (r + g + b) / 3;
                const tone = brightness > 180 ? 'claro' : brightness < 80 ? 'escuro' : 'médio';
                
                // Criar chave de grupo: cor+tom (ex: "azul-claro", "azul-médio", "azul-escuro")
                const groupKey = `${closestColor.name}-${tone}`;
                
                // Acumular valores RGB para média posterior
                if (!colorGroups.has(groupKey)) {
                    colorGroups.set(groupKey, {
                        name: closestColor.name,
                        tone: tone,
                        count: 0,
                        totalR: 0,
                        totalG: 0,
                        totalB: 0,
                        hex: closestColor.hex
                    });
                }
                
                const group = colorGroups.get(groupKey);
                group.count++;
                group.totalR += r;
                group.totalG += g;
                group.totalB += b;
            }
            
            // Converter grupos para array e calcular médias
            const groupsArray = Array.from(colorGroups.entries())
                .map(([key, group]) => {
                    // Calcular cor média do grupo
                    const avgR = Math.round(group.totalR / group.count);
                    const avgG = Math.round(group.totalG / group.count);
                    const avgB = Math.round(group.totalB / group.count);
                    const avgHex = rgbToHex(avgR, avgG, avgB);
                    
                    return {
                        key: key,
                        name: group.name,
                        tone: group.tone,
                        count: group.count,
                        hex: avgHex,
                        rgb: { r: avgR, g: avgG, b: avgB },
                        displayName: `${getPortugueseColorName(group.name)} ${group.tone}`,
                        colorName: getPortugueseColorName(group.name)
                    };
                })
                .sort((a, b) => b.count - a.count) // Ordenar por frequência
                .slice(0, type === 'estampado' ? 6 : 4); // Limitar número de grupos
            
            // Calcular porcentagens
            const totalPixels = groupsArray.reduce((sum, group) => sum + group.count, 0);
            groupsArray.forEach(group => {
                group.percentage = Math.round((group.count / totalPixels) * 100);
            });
            
            // Encontrar grupo predominante
            const dominantGroup = groupsArray.length > 0 ? groupsArray[0] : null;
            
            return {
                dominant: dominantGroup,
                groups: groupsArray,
                totalGroups: groupsArray.length,
                fabricType: type
            };
        }
        
        function findClosestBasicColor(r, g, b) {
            let closestColor = null;
            let minDistance = Infinity;
            
            // Encontrar cor básica mais próxima
            for (const [name, basicColor] of Object.entries(BASIC_COLORS)) {
                const distance = colorDistance(r, g, b, basicColor.r, basicColor.g, basicColor.b);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestColor = {
                        name: name,
                        hex: rgbToHex(basicColor.r, basicColor.g, basicColor.b),
                        distance: distance
                    };
                }
            }
            
            return closestColor;
        }
        
        function colorDistance(r1, g1, b1, r2, g2, b2) {
            // Distância Euclidiana simplificada
            return Math.sqrt(
                Math.pow(r1 - r2, 2) + 
                Math.pow(g1 - g2, 2) + 
                Math.pow(b1 - b2, 2)
            );
        }
        
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }
        
        function getPortugueseColorName(englishName) {
            const colorNames = {
                'vermelho': 'Vermelho',
                'laranja': 'Laranja',
                'amarelo': 'Amarelo',
                'verde': 'Verde',
                'azul': 'Azul',
                'roxo': 'Roxo',
                'rosa': 'Rosa',
                'marrom': 'Marrom',
                'preto': 'Preto',
                'branco': 'Branco',
                'cinza': 'Cinza',
                'bege': 'Bege'
            };
            
            return colorNames[englishName] || englishName;
        }
        
        function displayColorAnalysis(analysis) {
            const resultsContainer = document.getElementById('color-results');
            const colorPalette = document.getElementById('color-palette');
            const dominantColorDisplay = document.getElementById('dominant-color-display');
            const colorSuggestions = document.getElementById('color-suggestions');
            const threadSuggestions = document.getElementById('thread-suggestions');
            
            // Limpar resultados anteriores
            colorPalette.innerHTML = '';
            threadSuggestions.innerHTML = '';
            
            // Exibir cor predominante (SEM o título "Bege claro")
            if (analysis.dominant) {
                const colorName = analysis.dominant.colorName;
                
                dominantColorDisplay.innerHTML = `
                    <div class="report-dominant-preview" style="background-color: ${analysis.dominant.hex};"></div>
                    <div class="report-dominant-info">
                        <div style="font-size: 1.1rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                            ${analysis.dominant.hex.toUpperCase()}
                        </div>
                        <div class="color-result-line">
                            <strong>Presença:</strong> ${analysis.dominant.percentage}% da imagem
                        </div>
                        <div class="color-result-line" style="margin-top: 5px;">
                            <span class="dominant-badge">COR PREDOMINANTE</span>
                        </div>
                    </div>
                `;
                
                // Buscar sugestões de linhas para a cor predominante
                const threadSuggestionsData = findThreadSuggestions(analysis.dominant.name);
                if (threadSuggestionsData.length > 0) {
                    colorSuggestions.style.display = 'block';
                    threadSuggestionsData.forEach(thread => {
                        const threadElement = document.createElement('div');
                        threadElement.className = 'thread-item';
                        threadElement.innerHTML = `
                            <div class="thread-color" style="background-color: ${thread.color};"></div>
                            <div class="thread-info">
                                <div class="thread-code">${thread.code}</div>
                                <div class="thread-name">${thread.name}</div>
                            </div>
                        `;
                        threadSuggestions.appendChild(threadElement);
                    });
                }
            }
            
            // Exibir grupos de cores (SEM o título "Bege claro")
            analysis.groups.forEach((group, index) => {
                const isDominant = index === 0;
                const colorElement = document.createElement('div');
                
                colorElement.className = `color-item ${isDominant ? 'dominant-color' : ''}`;
                colorElement.innerHTML = `
                    <div class="color-preview" style="background-color: ${group.hex};"></div>
                    <div class="color-info">
                        <div class="color-code">${group.hex.toUpperCase()}</div>
                        <div class="color-percentage">${group.percentage}% da imagem</div>
                        <div class="color-group-info">
                            <i class="fas fa-layer-group"></i> Grupo de tons similares
                        </div>
                        ${isDominant ? '<div class="dominant-badge">PREDOMINANTE</div>' : ''}
                    </div>
                `;
                
                colorPalette.appendChild(colorElement);
            });
            
            // Mostrar resultados
            resultsContainer.style.display = 'block';
            
            // Scroll para resultados
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function findThreadSuggestions(baseColorName) {
            // Encontrar sugestões baseadas na cor predominante
            return THREAD_DATABASE[baseColorName] || 
                   THREAD_DATABASE.cinza || // Fallback para cinza
                   [{ code: 'N001', name: 'Neutro', color: '#808080' }];
        }
        
        function resetAnalysis() {
            // Limpar todos os dados
            currentImage = null;
            colorAnalysis = null;
            fabricType = '';
            
            // Limpar visualizações
            document.getElementById('image-preview-container').style.display = 'none';
            document.getElementById('color-results').style.display = 'none';
            document.getElementById('report-preview').style.display = 'none';
            document.getElementById('report-actions').style.display = 'none';
            
            // Resetar botões
            document.getElementById('analyze-btn').style.display = 'none';
            document.getElementById('generate-report-btn').style.display = 'none';
            
            // Resetar seleção de tecido
            document.querySelectorAll('.fabric-type').forEach(t => t.classList.remove('selected'));
            document.getElementById('fabric-type').value = '';
            
            // Resetar upload
            document.getElementById('image-input').value = '';
            document.querySelector('.upload-options').style.display = 'grid';
            
            // Parar webcam se estiver ativa
            stopWebcam();
            
            showSuccess('Sistema reiniciado. Pronto para nova análise.');
        }
        
        function generateReport() {
            if (!colorAnalysis || !currentImage) {
                showError('Por favor, faça uma análise primeiro.');
                return;
            }
            
            const reportPreview = document.getElementById('report-preview');
            const reportImage = document.getElementById('report-image');
            const reportDominantColor = document.getElementById('report-dominant-color');
            const reportFabricType = document.getElementById('report-fabric-type');
            const reportTotalColors = document.getElementById('report-total-colors');
            const reportAnalysisDate = document.getElementById('report-analysis-date');
            const reportDate = document.getElementById('report-date');
            
            // Atualizar dados do relatório
            const now = new Date();
            const formattedDate = now.toLocaleDateString('pt-BR') + ' ' + now.toLocaleTimeString('pt-BR');
            
            reportDate.textContent = `Data e hora: ${formattedDate}`;
            reportImage.src = currentImage.src;
            
            // Exibir cor predominante no relatório (SEM título)
            if (colorAnalysis.dominant) {
                reportDominantColor.innerHTML = `
                    <div class="report-dominant-color">
                        <div class="report-dominant-preview" style="background-color: ${colorAnalysis.dominant.hex};"></div>
                        <div class="report-dominant-info">
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                                ${colorAnalysis.dominant.hex.toUpperCase()}
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>Presença:</strong> ${colorAnalysis.dominant.percentage}%
                            </div>
                            <div>
                                <span class="dominant-badge">COR PREDOMINANTE</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Outras informações
            reportFabricType.textContent = colorAnalysis.fabricType === 'liso' ? 'Tecido Liso' : 'Tecido Estampado';
            reportTotalColors.textContent = colorAnalysis.totalGroups + ' famílias de cores';
            reportAnalysisDate.textContent = formattedDate;
            
            // Mostrar relatório
            reportPreview.style.display = 'block';
            document.getElementById('report-actions').style.display = 'flex';
            
            // Scroll para relatório
            reportPreview.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            showSuccess('Relatório gerado! Clique em "Baixar Relatório" para salvar.');
        }
        
        async function downloadReportAsImage() {
            const reportPreview = document.getElementById('report-preview');
            
            try {
                const canvas = await html2canvas(reportPreview, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false
                });
                
                // Converter para URL de dados
                const imageData = canvas.toDataURL('image/png', 1.0);
                
                // Criar link de download
                const link = document.createElement('a');
                link.href = imageData;
                link.download = `Relatorio_Cores_${new Date().toISOString().slice(0, 10)}.png`;
                link.click();
                
                showSuccess('Relatório baixado com sucesso!');
                
            } catch (error) {
                console.error('Erro ao gerar imagem:', error);
                showError('Erro ao gerar relatório.');
            }
        }
    </script>
</body>

</html>
